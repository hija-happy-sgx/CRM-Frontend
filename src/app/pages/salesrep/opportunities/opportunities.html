 <div class="min-h-screen bg-base-200 p-6">
      <div class="max-w-7xl mx-auto">
        <!-- Header -->
        <div class="flex justify-between items-center mb-8">
          <div>
            <h1 class="text-4xl font-bold text-base-content">Opportunities</h1>
            <p class="text-base-content/60 mt-2">Track and manage your deals</p>
          </div>
          <button class="btn btn-primary" (click)="showAddDealModal = true">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
            </svg>
            New Opportunity
          </button>
        </div>

        <!-- Stats -->
        <div class="grid grid-cols-1 md:grid-cols-5 gap-4 mb-8">
          <div class="stats shadow bg-base-100">
            <div class="stat">
              <div class="stat-title">Total Value</div>
              <div class="stat-value text-primary text-2xl">\${{ getTotalValue() | number:'1.0-0' }}</div>
            </div>
          </div>
          <div class="stats shadow bg-base-100">
            <div class="stat">
              <div class="stat-title">Prospecting</div>
              <div class="stat-value text-secondary text-2xl">{{ getDealsByStage('Prospecting').length }}</div>
            </div>
          </div>
          <div class="stats shadow bg-base-100">
            <div class="stat">
              <div class="stat-title">Negotiation</div>
              <div class="stat-value text-accent text-2xl">{{ getDealsByStage('Negotiation').length }}</div>
            </div>
          </div>
          <div class="stats shadow bg-base-100">
            <div class="stat">
              <div class="stat-title">Closed Won</div>
              <div class="stat-value text-success text-2xl">{{ getDealsByStage('Closed Won').length }}</div>
            </div>
          </div>
          <div class="stats shadow bg-base-100">
            <div class="stat">
              <div class="stat-title">Win Rate</div>
              <div class="stat-value text-info text-2xl">{{ getWinRate() }}%</div>
            </div>
          </div>
        </div>

        <!-- Pipeline View -->
        <div class="card bg-base-100 shadow-xl mb-6">
          <div class="card-body">
            <div class="flex justify-between items-center mb-4">
              <h2 class="card-title">Sales Pipeline</h2>
              <div class="btn-group">
                <button class="btn btn-sm" [class.btn-active]="viewMode === 'pipeline'" (click)="viewMode = 'pipeline'">Pipeline</button>
                <button class="btn btn-sm" [class.btn-active]="viewMode === 'table'" (click)="viewMode = 'table'">Table</button>
              </div>
            </div>

            <!-- Pipeline Kanban View -->
            <div *ngIf="viewMode === 'pipeline'" class="overflow-x-auto">
              <div class="flex gap-4 min-w-max pb-4">
                <div *ngFor="let stage of stages" class="w-80 flex-shrink-0">
                  <div class="card bg-base-200">
                    <div class="card-body p-4">
                      <h3 class="font-bold flex justify-between items-center">
                        <span>{{ stage }}</span>
                        <span class="badge badge-ghost">{{ getDealsByStage(stage).length }}</span>
                      </h3>
                      <div class="text-sm text-base-content/60 mb-2">
                        \${{ getStageValue(stage) | number:'1.0-0' }}
                      </div>
                      <div class="space-y-3 mt-4">
                        <div *ngFor="let deal of getDealsByStage(stage)" 
                             class="card bg-base-100 shadow hover:shadow-lg cursor-pointer transition-shadow"
                             (click)="viewDeal(deal)">
                          <div class="card-body p-4">
                            <h4 class="font-semibold text-sm">{{ deal.dealName }}</h4>
                            <p class="text-xs text-base-content/60">{{ deal.company || 'No Company' }}</p>
                            <div class="flex justify-between items-center mt-2">
                              <span class="text-lg font-bold text-success">\${{ deal.amount | number:'1.0-0' }}</span>
                              <span class="badge badge-sm" [ngClass]="{
                                'badge-success': deal.probability >= 75,
                                'badge-warning': deal.probability >= 50 && deal.probability < 75,
                                'badge-error': deal.probability < 50
                              }">{{ deal.probability }}%</span>
                            </div>
                            <div class="text-xs text-base-content/60 mt-2">
                              Close: {{ deal.expectedCloseDate | date:'MMM d, y' }}
                            </div>
                          </div>
                        </div>
                        <div *ngIf="!getDealsByStage(stage).length" class="text-center text-base-content/40 py-8">
                          No deals
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Table View -->
            <div *ngIf="viewMode === 'table'" class="overflow-x-auto">
              <div class="mb-4 flex gap-4">
                <input type="text" placeholder="Search deals..." class="input input-bordered w-full max-w-xs" [(ngModel)]="searchTerm" (input)="filterDeals()">
                <select class="select select-bordered" [(ngModel)]="filterStage" (change)="filterDeals()">
                  <option value="">All Stages</option>
                  <option *ngFor="let stage of stages" [value]="stage">{{ stage }}</option>
                </select>
              </div>
              
              <table class="table table-zebra">
                <thead>
                  <tr>
                    <th>Deal Name</th>
                    <th>Company</th>
                    <th>Amount</th>
                    <th>Stage</th>
                    <th>Probability</th>
                    <th>Close Date</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let deal of filteredDeals">
                    <td class="font-bold">{{ deal.dealName }}</td>
                    <td>{{ deal.company || '-' }}</td>
                    <td class="font-semibold text-success">\${{ deal.amount | number:'1.0-0' }}</td>
                    <td>
                      <div class="badge badge-outline">{{ deal.stage }}</div>
                    </td>
                    <td>
                      <div class="flex items-center gap-2">
                        <progress class="progress progress-success w-20" [value]="deal.probability" max="100"></progress>
                        <span class="text-sm">{{ deal.probability }}%</span>
                      </div>
                    </td>
                    <td class="text-sm">{{ deal.expectedCloseDate | date:'MMM d, y' }}</td>
                    <td>
                      <div class="flex gap-2">
                        <button class="btn btn-sm btn-ghost" (click)="viewDeal(deal)">
                          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                          </svg>
                        </button>
                        <button class="btn btn-sm btn-ghost" (click)="editDeal(deal)">
                          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                          </svg>
                        </button>
                      </div>
                    </td>
                  </tr>
                  <tr *ngIf="!filteredDeals.length">
                    <td colspan="7" class="text-center text-base-content/60">No deals found</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- View Deal Modal -->
        <div class="modal" [class.modal-open]="showViewDealModal">
          <div class="modal-box w-11/12 max-w-3xl">
            <h3 class="font-bold text-2xl mb-6">Deal Details</h3>
            <div *ngIf="selectedDeal" class="space-y-6">
              <div class="grid grid-cols-2 gap-6">
                <div>
                  <p class="text-sm text-base-content/60 mb-1">Deal Name</p>
                  <p class="text-lg font-bold">{{ selectedDeal.dealName }}</p>
                </div>
                <div>
                  <p class="text-sm text-base-content/60 mb-1">Company</p>
                  <p class="text-lg font-semibold">{{ selectedDeal.company || 'Not specified' }}</p>
                </div>
                <div>
                  <p class="text-sm text-base-content/60 mb-1">Amount</p>
                  <p class="text-2xl font-bold text-success">\${{ selectedDeal.amount | number:'1.0-0' }}</p>
                </div>
                <div>
                  <p class="text-sm text-base-content/60 mb-1">Stage</p>
                  <div class="badge badge-lg badge-outline">{{ selectedDeal.stage }}</div>
                </div>
                <div>
                  <p class="text-sm text-base-content/60 mb-1">Probability</p>
                  <div class="flex items-center gap-2">
                    <progress class="progress progress-success w-32" [value]="selectedDeal.probability" max="100"></progress>
                    <span class="font-bold">{{ selectedDeal.probability }}%</span>
                  </div>
                </div>
                <div>
                  <p class="text-sm text-base-content/60 mb-1">Expected Close Date</p>
                  <p class="font-semibold">{{ selectedDeal.expectedCloseDate | date:'fullDate' }}</p>
                </div>
                <div *ngIf="selectedDeal.actualCloseDate">
                  <p class="text-sm text-base-content/60 mb-1">Actual Close Date</p>
                  <p class="font-semibold">{{ selectedDeal.actualCloseDate | date:'fullDate' }}</p>
                </div>
                <div>
                  <p class="text-sm text-base-content/60 mb-1">Created</p>
                  <p class="font-semibold">{{ selectedDeal.createdAt | date:'medium' }}</p>
                </div>
              </div>

              <div class="divider"></div>

              <div>
                <h4 class="font-bold mb-3">Deal Timeline</h4>
                <ul class="steps steps-vertical">
                  <li class="step step-primary">Deal Created</li>
                  <li class="step" [class.step-primary]="selectedDeal.stage !== 'Prospecting'">Prospecting</li>
                  <li class="step" [class.step-primary]="['Negotiation', 'Closed Won', 'Closed Lost'].includes(selectedDeal.stage)">Negotiation</li>
                  <li class="step" [class.step-success]="selectedDeal.stage === 'Closed Won'" [class.step-error]="selectedDeal.stage === 'Closed Lost'">
                    {{ selectedDeal.stage === 'Closed Won' ? 'Won' : selectedDeal.stage === 'Closed Lost' ? 'Lost' : 'Pending' }}
                  </li>
                </ul>
              </div>
            </div>
            <div class="modal-action">
              <button class="btn" (click)="showViewDealModal = false">Close</button>
              <button class="btn btn-primary" (click)="editDeal(selectedDeal!)">Edit Deal</button>
            </div>
          </div>
        </div>

        <!-- Add Deal Modal -->
        <div class="modal" [class.modal-open]="showAddDealModal">
          <div class="modal-box w-11/12 max-w-2xl">
            <h3 class="font-bold text-lg mb-4">New Opportunity</h3>
            <form (submit)="createDeal()">
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="form-control md:col-span-2">
                  <label class="label"><span class="label-text">Deal Name</span></label>
                  <input type="text" class="input input-bordered" [(ngModel)]="newDeal.dealName" name="dealName" required>
                </div>
                <div class="form-control">
                  <label class="label"><span class="label-text">Company</span></label>
                  <input type="text" class="input input-bordered" [(ngModel)]="newDeal.company" name="company">
                </div>
                <div class="form-control">
                  <label class="label"><span class="label-text">Amount ($)</span></label>
                  <input type="number" class="input input-bordered" [(ngModel)]="newDeal.amount" name="amount" required>
                </div>
                <div class="form-control">
                  <label class="label"><span class="label-text">Stage</span></label>
                  <select class="select select-bordered" [(ngModel)]="newDeal.stage" name="stage" required>
                    <option value="">Select stage</option>
                    <option *ngFor="let stage of stages" [value]="stage">{{ stage }}</option>
                  </select>
                </div>
                <div class="form-control">
                  <label class="label"><span class="label-text">Probability (%)</span></label>
                  <input type="number" min="0" max="100" class="input input-bordered" [(ngModel)]="newDeal.probability" name="probability" required>
                </div>
                <div class="form-control md:col-span-2">
                  <label class="label"><span class="label-text">Expected Close Date</span></label>
                  <input type="date" class="input input-bordered" [(ngModel)]="newDeal.expectedCloseDate" name="expectedCloseDate" required>
                </div>
              </div>
              <div class="modal-action">
                <button type="button" class="btn" (click)="showAddDealModal = false">Cancel</button>
                <button type="submit" class="btn btn-primary">Create Opportunity</button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>